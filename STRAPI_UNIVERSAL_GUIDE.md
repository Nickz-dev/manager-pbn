# Strapi Universal Environment Guide

## üéØ –¶–µ–ª—å
–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è–º–∏ Strapi, Next.js, Builder –∏ Preview –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ –∏ VPS.

## üìã –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)
```bash
# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
USE_LOCAL_STRAPI=false                    # true = –ª–æ–∫–∞–ª—å–Ω—ã–π, false = VPS
NEXT_PUBLIC_USE_LOCAL_STRAPI=false       # –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —á–∞—Å—Ç–∏
VPS_ADDRESS=185.232.205.247              # –∞–¥—Ä–µ—Å VPS (–±–µ–∑ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞)

# –ü–æ—Ä—Ç—ã
PORT=3000                                 # –ø–æ—Ä—Ç Next.js
STRAPI_PORT=1337                         # –ø–æ—Ä—Ç Strapi

# –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
JWT_SECRET=–≤–∞—à_jwt_—Å–µ–∫—Ä–µ—Ç
STRAPI_TOKEN=–≤–∞—à_–ø–æ–ª–Ω—ã–π_jwt_—Ç–æ–∫–µ–Ω_–∑–¥–µ—Å—å
```

## üöÄ –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º

### –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
```bash
node scripts/fix-vps-all.js
```

### –ü–æ—à–∞–≥–æ–≤–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

**1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
node scripts/check-vps-frontend.js
```

**2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ VPS:**
```bash
node scripts/fix-vps-env.js
```

**3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø—Ä–µ–≤—å—é:**
```bash
node scripts/fix-preview-deps.js
```

**4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤:**
```bash
node scripts/restart-vps.js
```

## üîß –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:
- `fix-vps-all.js` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º
- `check-vps-frontend.js` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- `fix-vps-env.js` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `fix-preview-deps.js` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø—Ä–µ–≤—å—é
- `restart-vps.js` - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

### –£—Ç–∏–ª–∏—Ç—ã:
- `check-environment.js` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `switch-strapi-env.js` - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –ª–æ–∫–∞–ª—å–Ω—ã–º –∏ VPS
- `generate-strapi-keys.js` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π –¥–ª—è Strapi
- `test-strapi-connection.js` - —Ç–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Strapi

### –°–±–æ—Ä–∫–∞ –∏ –¥–∞–Ω–Ω—ã–µ:
- `build-astro.js` - —Å–±–æ—Ä–∫–∞ Astro —Å–∞–π—Ç–æ–≤
- `generate-astro-data.js` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Astro
- `export-strapi-data.js` - —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö Strapi
- `import-strapi-data.js` - –∏–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö Strapi
- `deploy-to-vps.js` - –¥–µ–ø–ª–æ–π –Ω–∞ VPS

## üåê URL –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### –õ–æ–∫–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
- **Strapi:** http://localhost:1337
- **Next.js:** http://localhost:3000
- **Preview:** http://localhost:4321
- **Strapi Admin:** http://localhost:1337/admin

### VPS –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
- **Strapi:** http://185.232.205.247:1337
- **Next.js:** http://185.232.205.247:3000
- **Preview:** http://185.232.205.247:4321
- **Strapi Admin:** http://185.232.205.247:1337/admin

## üîÑ –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å

### –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `USE_LOCAL_STRAPI=true`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π Strapi: `cd strapi && npm run develop`
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Next.js: `npm run dev`

### –î–ª—è VPS:
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `node scripts/fix-vps-all.js`
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã: `node scripts/restart-vps.js`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
node scripts/switch-strapi-env.js
```

## üìä –®–∞–±–ª–æ–Ω—ã

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —à–∞–±–ª–æ–Ω—ã:
- `astro-pbn-blog` - PBN –±–ª–æ–≥
- `astro-gaming-news` - –∏–≥—Ä–æ–≤—ã–µ –Ω–æ–≤–æ—Å—Ç–∏
- `astro-poker-platform` - –ø–æ–∫–µ—Ä –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
- `astro-slots-review` - –æ–±–∑–æ—Ä—ã —Å–ª–æ—Ç–æ–≤
- `astro-sports-betting` - —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ —Å—Ç–∞–≤–∫–∏
- `casino-standard` - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∫–∞–∑–∏–Ω–æ

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. **Strapi Status** - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
2. **–°–æ–∑–¥–∞–Ω–∏–µ —Å–∞–π—Ç–∞** - —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
3. **–°–±–æ—Ä–∫–∞ —Å–∞–π—Ç–∞** - –ø–∞–π–ø–ª–∞–π–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. **–ü—Ä–µ–≤—å—é —Å–∞–π—Ç–∞** - –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 4321
5. **API –∑–∞–ø—Ä–æ—Å—ã** - –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –æ—Ç–≤–µ—á–∞—é—Ç

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
node scripts/check-environment.js

# –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Strapi
node scripts/test-strapi-connection.js

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
node scripts/check-vps-frontend.js
```

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "Invalid URL"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `VPS_ADDRESS` –≤ `.env`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –ü—Ä–æ–±–ª–µ–º–∞: "Cannot find module @rollup/rollup-x64-gnu"
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ `node scripts/fix-preview-deps.js`
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–µ–≤—å—é —Å–µ—Ä–≤–µ—Ä

### –ü—Ä–æ–±–ª–µ–º–∞: "Build error"
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ `node scripts/fix-vps-all.js`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤—Å–µ—Ö —à–∞–±–ª–æ–Ω–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞: "401 Unauthorized"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `STRAPI_TOKEN` –≤ `.env`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –ø–æ–ª–Ω—ã–π –∏ –Ω–µ –æ–±—Ä–µ–∑–∞–Ω

## üéâ –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ!

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—é —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∏ VPS –æ–∫—Ä—É–∂–µ–Ω–∏–π. 